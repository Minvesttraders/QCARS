        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8" />
            <link rel="icon" type="image/svg+xml" href="/vite.svg" />
            <meta name="viewport" content="width=device-width, initial-scale=1.0" />
            <title>QCARS App</title>
            <!-- Google Fonts - Inter for clean typography -->
            <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet" />
            <!-- Tailwind CSS CDN - (Development use. For production, integrate via PostCSS) -->
            <script src="https://cdn.tailwindcss.com"></script>
            <!-- Font Awesome for icons -->
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
            <style>
                /* Custom scrollbar for better UX in chat */
                .custom-scrollbar::-webkit-scrollbar {
                    width: 8px;
                }

                .custom-scrollbar::-webkit-scrollbar-track {
                    background: #f1f1f1;
                    border-radius: 10px;
                }

                .custom-scrollbar::-webkit-scrollbar-thumb {
                    background: #888;
                    border-radius: 10px;
                }

                .custom-scrollbar::-webkit-scrollbar-thumb:hover {
                    background: #555;
               } 

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
  <!-- Google Fonts: Inter + Noto Nastaliq Urdu -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Noto+Nastaliq+Urdu&display=swap" rel="stylesheet"/>

  <style>
    body { font-family: 'Inter', sans-serif; }
    .font-urdu { font-family: 'Noto Nastaliq Urdu', serif; }
    .hover-3d { transition: transform .3s ease, box-shadow .3s ease; }
    .hover-3d:hover { transform: translateY(-8px) rotateX(2deg); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
    .fade-scale { transition: opacity .3s ease, transform .3s ease; transform: scale(0.95); opacity: 0; }
    .fade-scale.active { transform: scale(1); opacity: 1; }
    .blur-bg { backdrop-filter: blur(4px); }
  </style>

  <!-- Appwrite SDK -->
  <script src="https://cdn.jsdelivr.net/npm/appwrite@8.4.0"></script>
  <script>
    // ==== CONFIG ====
    const APPWRITE = {
      endpoint: 'https://cloud.appwrite.io/v1',
      projectId: '685ed548003693db4ec5',
      apiKey: 'standard_3ba1605ea035dabbcf64046a7094e9418cf362eef3971d71408ae7c',
      databases: {
        id: 'default',
        collections: {
          users: 'users',
          posts: 'posts',
          chats: 'chats'
        }
      },
      storage: { bucket: 'car_images' }
    };

    // ==== INIT CLIENT ====
    const client  = new Appwrite.Client()
                      .setEndpoint(APPWRITE.endpoint)
                      .setProject(APPWRITE.projectId);
    const account   = new Appwrite.Account(client);
    const db        = new Appwrite.Databases(client);
    const storage   = new Appwrite.Storage(client);
    const realtime  = new Appwrite.Realtime(client);

    // App state
    let currentUser = null;
    let currentRole = 'guest';
    let paymentsRequired = false;
    let lang = 'en'; // default

    const STR = {
      en: {
        login: 'Log In',
        signup: 'Sign Up',
        email: 'Email',
        password: 'Password',
        switchTo: 'Switch to Urdu',
        search: 'Search cars by name or model...',
        post: '+ Post Car',
        name: 'Car Name',
        model: 'Model',
        condition: 'Condition',
        price: 'Price',
        description: 'Description',
        upload: 'Upload Images (max 20)',
        publish: 'Publish',
        profile: 'My Profile',
        globalChat: 'Global Chat',
        privateChat: 'Private Chat',
        send: 'Send',
        adminPanel: 'Admin Dashboard',
        paymentsToggle: 'Require Membership Payment',
        approve: 'Approve',
        reject: 'Reject',
        mute: 'Mute',
        promote: 'Promote',
        rating: 'Rating'
      },
      ur: {
        login: 'لاگ ان کریں',
        signup: 'نیا اکاؤنٹ',
        email: 'ای میل',
        password: 'پاس ورڈ',
        switchTo: 'Switch to English',
        search: 'نام یا ماڈل سے تلاش کریں...',
        post: '+ کار پوسٹ کریں',
        name: 'گاڑی کا نام',
        model: 'ماڈل',
        condition: 'حالت',
        price: 'قیمت',
        description: 'تفصیل',
        upload: 'تصاویر اپلوڈ کریں (زیادہ سے زیادہ 20)',
        publish: 'شائع کریں',
        profile: 'میری پروفائل',
        globalChat: 'عالمی چیٹ',
        privateChat: 'پرائیویٹ چیٹ',
        send: 'بھیجیں',
        adminPanel: 'ایڈمن ڈیش بورڈ',
        paymentsToggle: 'رکنیت کی ادائیگی درکار ہے',
        approve: 'منظور کریں',
        reject: 'رد کریں',
        mute: 'خاموش کریں',
        promote: 'ترقی دیں',
        rating: 'درجہ بندی'
      }
    };
  </script>
</head>
<body>
            <div id="root"></div>
            <script type="module" src="/src/main.jsx"></script>pp
<body class="bg-gray-100 text-gray-800">
   </body>

  <!-- ========== AUTH MODAL ========== -->
  <div id="authModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
    <div id="authPanel" class="bg-white rounded-lg p-6 w-80 fade-scale">
      <h2 id="authTitle" class="text-2xl mb-4 text-center">Log In</h2>
      <form id="authForm" class="space-y-4">
        <input id="authEmail" type="email" placeholder="Email" required
               class="w-full px-3 py-2 border rounded"/>
        <input id="authPassword" type="password" placeholder="Password" required
               class="w-full px-3 py-2 border rounded"/>
        <button type="submit" class="w-full py-2 bg-[#00C9B8] text-[#1A202C] rounded">
          Log In
        </button>
      </form>
      <p id="authSwitch" class="mt-4 text-center text-sm text-gray-600 cursor-pointer">
        Don't have an account? Sign Up
      </p>
    </div>
  </div>

  <!-- ========== HEADER ========== -->
  <header class="bg-[#1A202C] text-white px-4 py-3 flex flex-wrap justify-between items-center shadow-md">
    <div class="flex items-center gap-4">
      <div class="text-2xl font-bold text-[#00C9B8]">Quetta Cars</div>
      <input id="searchInput" type="text"
             placeholder="Search cars by name or model..."
             class="hidden sm:block px-4 py-2 rounded-md bg-[#2D3748] text-sm text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-[#00C9B8] w-64"/>
    </div>
    <div class="flex items-center gap-3 mt-3 sm:mt-0">
      <button id="langToggle" class="px-3 py-1 bg-[#00C9B8] text-[#1A202C] rounded hover:scale-105 transition text-sm font-semibold">
        Switch to Urdu
      </button>
      <button id="postBtn" class="hidden sm:block px-4 py-2 bg-[#00C9B8] text-[#1A202C] rounded hover:scale-105 transition font-medium">
        + Post Car
      </button>
      <button id="profileBtn" class="text-xl hover:text-[#00C9B8]">
        <i class="fas fa-user-circle"></i>
      </button>
      <button id="chatBtn" class="text-xl hover:text-[#00C9B8]">
        <i class="fas fa-comments"></i>
      </button>
    </div>
  </header>

  <!-- ========== MAIN FEED ========== -->
  <main id="feed" class="p-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
    <!-- Car cards will be injected here -->
  </main>

  <!-- ========== POST MODAL ========== -->
  <div id="postModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
    <div class="bg-white rounded-lg w-11/12 md:w-2/3 lg:w-1/2 p-6 relative fade-scale">
      <button id="closePost" class="absolute top-4 right-4 text-gray-600"><i class="fas fa-times"></i></button>
      <h2 class="text-2xl mb-4">+ Post Car</h2>
      <form id="postForm" class="space-y-4 max-h-[80vh] overflow-auto">
        <input name="title" type="text" placeholder="Car Name" required class="w-full px-3 py-2 border rounded"/>
        <input name="model" type="text" placeholder="Model" required class="w-full px-3 py-2 border rounded"/>
        <input name="condition" type="text" placeholder="Condition" required class="w-full px-3 py-2 border rounded"/>
        <input name="price" type="number" placeholder="Price" required class="w-full px-3 py-2 border rounded"/>
        <textarea name="description" rows="4" placeholder="Description" class="w-full px-3 py-2 border rounded"></textarea>
        <div>
          <label class="block mb-2">Upload Images (max 20)</label>
          <input id="imgInput" type="file" multiple accept="image/*" class="w-full"/>
          <div id="imgPreview" class="grid grid-cols-3 gap-2 mt-2"></div>
        </div>
        <button type="submit" class="w-full py-2 bg-[#00C9B8] text-[#1A202C] rounded">Publish</button>
      </form>
    </div>
  </div>

  <!-- ========== CAR DETAIL MODAL ========== -->
  <div id="detailModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
    <div class="bg-white rounded-lg w-11/12 md:w-3/4 lg:w-1/2 p-6 relative fade-scale overflow-auto max-h-[90vh]">
      <button id="closeDetail" class="absolute top-4 right-4 text-gray-600"><i class="fas fa-times"></i></button>
      <div id="detailGallery" class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4"></div>
      <h2 id="detailTitle" class="text-2xl font-bold mb-2"></h2>
      <p id="detailModel" class="text-gray-600 mb-2"></p>
      <p id="detailCondition" class="text-gray-600 mb-2"></p>
      <p id="detailPrice" class="text-[#00C9B8] font-semibold mb-4"></p>
      <p id="detailDesc" class="mb-4"></p>
    </div>
  </div>

  <!-- ========== CHAT MODAL ========== -->
  <div id="chatModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
    <div class="bg-white rounded-lg w-11/12 md:w-2/3 lg:w-1/2 p-4 relative fade-scale">
      <button id="closeChat" class="absolute top-4 right-4 text-gray-600"><i class="fas fa-times"></i></button>
      <div class="flex justify-between items-center mb-4">
        <h2 id="chatTitle" class="text-xl">Global Chat</h2>
        <button id="switchChat" class="px-2 py-1 bg-gray-200 rounded text-sm">Private Chat</button>
      </div>
      <div id="chatBody" class="h-64 overflow-auto mb-4 space-y-2"></div>
      <div class="flex items-center">
        <input id="chatInput" type="text" placeholder="Type a message" class="flex-1 px-3 py-2 border rounded"/>
        <button id="sendChat" class="ml-2 px-4 py-2 bg-[#00C9B8] text-[#1A202C] rounded"><i class="fas fa-paper-plane"></i></button>
        <button id="voiceBtn" class="ml-2 px-3 py-2 bg-gray-200 rounded"><i class="fas fa-microphone"></i></button>
      </div>
    </div>
  </div>

  <!-- ========== PROFILE MODAL ========== -->
  <div id="profileModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
    <div class="bg-white rounded-lg w-11/12 md:w-2/3 lg:w-1/2 p-6 relative fade-scale overflow-auto max-h-[90vh]">
      <button id="closeProfile" class="absolute top-4 right-4 text-gray-600"><i class="fas fa-times"></i></button>
      <div class="flex items-center gap-4 mb-6">
        <img id="profilePic" src="" alt="Profile" class="w-20 h-20 rounded-full object-cover border"/>
        <div>
          <h2 id="profileName" class="text-2xl font-bold"></h2>
          <p id="profileContact" class="text-gray-600"></p>
          <p class="flex items-center gap-1">
            <i class="fas fa-star text-yellow-400"></i>
            <span id="profileRating">0.0</span>/
            <span>5</span>
          </p>
        </div>
      </div>
      <div id="profilePosts" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
    </div>
  </div>

  <!-- ========== ADMIN PANEL ========== -->
  <div id="adminPanel" class="fixed top-0 right-0 bg-white w-80 h-full shadow-lg p-4 overflow-auto hidden">
    <h2 class="text-2xl mb-4">Admin Dashboard</h2>
    <div class="mb-4">
      <label class="flex items-center gap-2">
        <input type="checkbox" id="paymentsToggle"/>
        <span>Require Membership Payment</span>
      </label>
    </div>
    <div id="userApprovals" class="mb-6">
      <h3 class="text-lg font-semibold mb-2">Pending Users</h3>
      <!-- pending user cards -->
    </div>
    <div id="moderation" class="mb-6">
      <h3 class="text-lg font-semibold mb-2">Moderation</h3>
      <!-- approve/mute/promote -->
    </div>
    <div id="postApprovals">
      <h3 class="text-lg font-semibold mb-2">Post Approvals</h3>
      <!-- posts awaiting approval -->
    </div>
  </div>

  <!-- ========== SCRIPT LOGIC (Appwrite + UI) ========== -->
  <script>
  // Utility: toggle fade-scale modals
  function openModal(id) {
    const m = document.getElementById(id);
    m.classList.remove('hidden');
    setTimeout(()=> m.querySelector('.fade-scale').classList.add('active'), 10);
  }
  function closeModal(id) {
    const m = document.getElementById(id);
    m.querySelector('.fade-scale').classList.remove('active');
    setTimeout(()=> m.classList.add('hidden'), 300);
  }

  // Language toggle
  const langToggle = document.getElementById('langToggle');
  function applyLang() {
    document.documentElement.lang = lang;
    document.getElementById('authTitle').innerText = STR[lang][ currentUser? 'login':'signup' ];
    document.getElementById('authEmail').placeholder = STR[lang].email;
    document.getElementById('authPassword').placeholder = STR[lang].password;
    authForm.querySelector('button').innerText = currentUser? STR[lang].login:STR[lang].signup;
    authSwitch.innerText = currentUser? STR[lang].signup:STR[lang].login;
    document.getElementById('searchInput').placeholder = STR[lang].search;
    postBtn.innerText = STR[lang].post;
    document.querySelector('#postForm [name="title"]').placeholder = STR[lang].name;
    document.querySelector('#postForm [name="model"]').placeholder = STR[lang].model;
    document.querySelector('#postForm [name="condition"]').placeholder = STR[lang].condition;
    document.querySelector('#postForm [name="price"]').placeholder = STR[lang].price;
    document.querySelector('#postForm textarea').placeholder = STR[lang].description;
    document.querySelector('#postForm label').innerText = STR[lang].upload;
    document.querySelector('#postForm button[type="submit"]').innerText = STR[lang].publish;
    document.getElementById('profileBtn').title = STR[lang].profile;
    document.getElementById('chatBtn').title = STR[lang].globalChat;
    document.getElementById('adminPanel').querySelector('h2').innerText = STR[lang].adminPanel;
    langToggle.innerText = lang==='en'? STR[lang].switchTo : STR[lang].switchTo;
  }
  langToggle.onclick = ()=>{
    lang = lang==='en'? 'ur':'en';
    applyLang();
  };

  // ===== AUTH =====
  const authModal  = document.getElementById('authModal');
  const authForm   = document.getElementById('authForm');
  const authSwitch = document.getElementById('authSwitch');
  let isSignup     = false;

  function showAuth(signup=false) {
    isSignup = signup;
    openModal('authModal');
    document.getElementById('authTitle').innerText = signup? STR[lang].signup:STR[lang].login;
    authForm.querySelector('button').innerText = signup? STR[lang].signup:STR[lang].login;
    authSwitch.innerText = signup? STR[lang].login:STR[lang].signup;
    document.getElementById('authEmail').value = '';
    document.getElementById('authPassword').value = '';
  }
  authSwitch.onclick = ()=> showAuth(!isSignup);
  authForm.onsubmit = async e=>{
    e.preventDefault();
    const email = authEmail.value;
    const pw    = authPassword.value;
    try {
      let session;
      if (isSignup) {
        session = await account.create('unique()', email, pw);
        // create user doc
        await db.createDocument(
          APPWRITE.databases.id,
          APPWRITE.databases.collections.users,
          session.$id,
          { email, status: paymentsRequired?'payment_pending':'active', role:'user', joinedAt:new Date().toISOString() }
        );
        // if first user: make admin
        const list = await db.listDocuments(APPWRITE.databases.id, APPWRITE.databases.collections.users, [], 1, 0, undefined, ['\$createdAt']);
        if (list.total===1) {
          currentRole = 'admin';
          await db.updateDocument(APPWRITE.databases.id, APPWRITE.databases.collections.users, session.$id, { role:'admin', status:'active' });
        }
      } else {
        session = await account.createEmailSession(email, pw);
      }
      currentUser = await account.get();
      closeModal('authModal');
      initApp();
    } catch(err) {
      alert(err.message);
    }
  };

  // ===== INIT APP =====
  async function initApp(){
    try {
      currentUser = await account.get();
    } catch {
      return showAuth(false);
    }
    // fetch role and settings
    const udoc = await db.getDocument(APPWRITE.databases.id, APPWRITE.databases.collections.users, currentUser.$id);
    currentRole = udoc.role;
    paymentsRequired = udoc.paymentsRequired || false;
    // show main UI
    buildApp();
  }

  // ===== BUILD APP UI =====
  const header = document.querySelector('header');
  const mainFeed = document.getElementById('feed');
  const postBtn = document.getElementById('postBtn');
  const profileBtn = document.getElementById('profileBtn');
  const chatBtn = document.getElementById('chatBtn');
  const closePost = document.getElementById('closePost');
  const postModal = document.getElementById('postModal');
  const imgInput = document.getElementById('imgInput');
  const imgPreview = document.getElementById('imgPreview');
  const postForm = document.getElementById('postForm');
  const closeDetail = document.getElementById('closeDetail');
  const detailModal = document.getElementById('detailModal');
  const closeChat = document.getElementById('closeChat');
  const chatModal = document.getElementById('chatModal');
  const switchChat = document.getElementById('switchChat');
  const sendChat = document.getElementById('sendChat');
  const chatBody = document.getElementById('chatBody');
  const chatInput = document.getElementById('chatInput');
  const voiceBtn = document.getElementById('voiceBtn');
  const profileModal = document.getElementById('profileModal');
  const closeProfile = document.getElementById('closeProfile');
  const profilePosts = document.getElementById('profilePosts');
  const paymentsToggle = document.getElementById('paymentsToggle');
  const adminPanel = document.getElementById('adminPanel');

  // Search
  document.getElementById('searchInput').oninput = e => loadFeed(e.target.value);

  // Modals
  postBtn.onclick = ()=> openModal('postModal');
  closePost.onclick = ()=> closeModal('postModal');
  profileBtn.onclick = ()=> openProfile(currentUser.$id);
  closeProfile.onclick = ()=> closeModal('profileModal');
  chatBtn.onclick = ()=> openModal('chatModal');
  closeChat.onclick = ()=> closeModal('chatModal');
  closeDetail.onclick = ()=> closeModal('detailModal');

  // Image preview
  imgInput.onchange = ()=>{
    imgPreview.innerHTML = '';
    Array.from(imgInput.files).slice(0,20).forEach(f=>{
      const r = new FileReader();
      r.onload = e=>{
        const img = document.createElement('img');
        img.src = e.target.result;
        img.className = 'w-full h-24 object-cover rounded';
        imgPreview.appendChild(img);
      };
      r.readAsDataURL(f);
    });
  };

  // ===== LOAD FEED =====
  async function loadFeed(filter=''){
    const resp = await db.listDocuments(
      APPWRITE.databases.id,
      APPWRITE.databases.collections.posts,
      [],
      100, 0,
      filter?`title~=${filter}`:undefined,
      ['-createdAt']
    );
    mainFeed.innerHTML = '';
    resp.documents.forEach(post=>{
      const card = document.createElement('div');
      card.className = 'bg-white p-4 rounded-lg hover-3d cursor-pointer';
      card.innerHTML = `
        <img src="${post.imageURLs?.[0]||''}" class="w-full h-40 object-cover rounded mb-2"/>
        <h3 class="font-bold">${post.title}</h3>
        <p class="text-gray-600 text-sm">${post.model}</p>
        <p class="text-[#00C9B8] font-semibold mt-1">$${post.price}</p>
      `;
      card.onclick = ()=> openDetail(post);
      mainFeed.appendChild(card);
    });
  }

  // Realtime feed
  realtime.subscribe(
    [`databases.${APPWRITE.databases.id}.collections.${APPWRITE.databases.collections.posts}.documents`],
    () => loadFeed(document.getElementById('searchInput').value)
  );

  // ===== POST CREATION =====
  postForm.onsubmit = async e=>{
    e.preventDefault();
    const data = new FormData(e.target);
    // create doc
    const post = await db.createDocument(
      APPWRITE.databases.id,
      APPWRITE.databases.collections.posts,
      Appwrite.ID.unique(),
      {
        title: data.get('title'),
        model: data.get('model'),
        condition: data.get('condition'),
        price: Number(data.get('price')),
        description: data.get('description'),
        ownerId: currentUser.$id,
        createdAt: new Date().toISOString()
      }
    );
    // upload images
    const files = Array.from(imgInput.files).s<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Quetta Cars – Dealer Network</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
  <!-- Google Fonts: Inter + Noto Nastaliq Urdu -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Noto+Nastaliq+Urdu&display=swap" rel="stylesheet"/>

  <style>
    body { font-family: 'Inter', sans-serif; }
    .font-urdu { font-family: 'Noto Nastaliq Urdu', serif; }
    .hover-3d { transition: transform .3s ease, box-shadow .3s ease; }
    .hover-3d:hover { transform: translateY(-8px) rotateX(2deg); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
    .fade-scale { transition: opacity .3s ease, transform .3s ease; transform: scale(0.95); opacity: 0; }
    .fade-scale.active { transform: scale(1); opacity: 1; }
    .blur-bg { backdrop-filter: blur(4px); }
  </style>

  <!-- Appwrite SDK -->
  <script src="https://cdn.jsdelivr.net/npm/appwrite@8.4.0"></script>
  <script>
    // ==== CONFIG ====
    const APPWRITE = {
      endpoint: 'https://cloud.appwrite.io/v1',
      projectId: '685ed548003693db4ec5',
      apiKey: 'standard_3ba1605ea035dabbcf64046a7094e9418cf362eef3971d71408ae7c',
      databases: {
        id: 'default',
        collections: {
          users: 'users',
          posts: 'posts',
          chats: 'chats'
        }
      },
      storage: { bucket: 'car_images' }
    };

    // ==== INIT CLIENT ====
    const client  = new Appwrite.Client()
                      .setEndpoint(APPWRITE.endpoint)
                      .setProject(APPWRITE.projectId);
    const account   = new Appwrite.Account(client);
    const db        = new Appwrite.Databases(client);
    const storage   = new Appwrite.Storage(client);
    const realtime  = new Appwrite.Realtime(client);

    // App state
    let currentUser = null;
    let currentRole = 'guest';
    let paymentsRequired = false;
    let lang = 'en'; // default

    const STR = {
      en: {
        login: 'Log In',
        signup: 'Sign Up',
        email: 'Email',
        password: 'Password',
        switchTo: 'Switch to Urdu',
        search: 'Search cars by name or model...',
        post: '+ Post Car',
        name: 'Car Name',
        model: 'Model',
        condition: 'Condition',
        price: 'Price',
        description: 'Description',
        upload: 'Upload Images (max 20)',
        publish: 'Publish',
        profile: 'My Profile',
        globalChat: 'Global Chat',
        privateChat: 'Private Chat',
        send: 'Send',
        adminPanel: 'Admin Dashboard',
        paymentsToggle: 'Require Membership Payment',
        approve: 'Approve',
        reject: 'Reject',
        mute: 'Mute',
        promote: 'Promote',
        rating: 'Rating'
      },
      ur: {
        login: 'لاگ ان کریں',
        signup: 'نیا اکاؤنٹ',
        email: 'ای میل',
        password: 'پاس ورڈ',
        switchTo: 'Switch to English',
        search: 'نام یا ماڈل سے تلاش کریں...',
        post: '+ کار پوسٹ کریں',
        name: 'گاڑی کا نام',
        model: 'ماڈل',
        condition: 'حالت',
        price: 'قیمت',
        description: 'تفصیل',
        upload: 'تصاویر اپلوڈ کریں (زیادہ سے زیادہ 20)',
        publish: 'شائع کریں',
        profile: 'میری پروفائل',
        globalChat: 'عالمی چیٹ',
        privateChat: 'پرائیویٹ چیٹ',
        send: 'بھیجیں',
        adminPanel: 'ایڈمن ڈیش بورڈ',
        paymentsToggle: 'رکنیت کی ادائیگی درکار ہے',
        approve: 'منظور کریں',
        reject: 'رد کریں',
        mute: 'خاموش کریں',
        promote: 'ترقی دیں',
        rating: 'درجہ بندی'
      }
    };
  </script>
</head>
<body>
            <div id="root"></div>
            <script type="module" src="/src/main.jsx"></script>
<body class="bg-gray-100 text-gray-800">
   </body>

  <!-- ========== AUTH MODAL ========== -->
  <div id="authModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
    <div id="authPanel" class="bg-white rounded-lg p-6 w-80 fade-scale">
      <h2 id="authTitle" class="text-2xl mb-4 text-center">Log In</h2>
      <form id="authForm" class="space-y-4">
        <input id="authEmail" type="email" placeholder="Email" required
               class="w-full px-3 py-2 border rounded"/>
        <input id="authPassword" type="password" placeholder="Password" required
               class="w-full px-3 py-2 border rounded"/>
        <button type="submit" class="w-full py-2 bg-[#00C9B8] text-[#1A202C] rounded">
          Log In
        </button>
      </form>
      <p id="authSwitch" class="mt-4 text-center text-sm text-gray-600 cursor-pointer">
        Don't have an account? Sign Up
      </p>
    </div>
  </div>

  <!-- ========== HEADER ========== -->
  <header class="bg-[#1A202C] text-white px-4 py-3 flex flex-wrap justify-between items-center shadow-md">
    <div class="flex items-center gap-4">
      <div class="text-2xl font-bold text-[#00C9B8]">Quetta Cars</div>
      <input id="searchInput" type="text"
             placeholder="Search cars by name or model..."
             class="hidden sm:block px-4 py-2 rounded-md bg-[#2D3748] text-sm text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-[#00C9B8] w-64"/>
    </div>
    <div class="flex items-center gap-3 mt-3 sm:mt-0">
      <button id="langToggle" class="px-3 py-1 bg-[#00C9B8] text-[#1A202C] rounded hover:scale-105 transition text-sm font-semibold">
        Switch to Urdu
      </button>
      <button id="postBtn" class="hidden sm:block px-4 py-2 bg-[#00C9B8] text-[#1A202C] rounded hover:scale-105 transition font-medium">
        + Post Car
      </button>
      <button id="profileBtn" class="text-xl hover:text-[#00C9B8]">
        <i class="fas fa-user-circle"></i>
      </button>
      <button id="chatBtn" class="text-xl hover:text-[#00C9B8]">
        <i class="fas fa-comments"></i>
      </button>
    </div>
  </header>

  <!-- ========== MAIN FEED ========== -->
  <main id="feed" class="p-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
    <!-- Car cards will be injected here -->
  </main>

  <!-- ========== POST MODAL ========== -->
  <div id="postModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
    <div class="bg-white rounded-lg w-11/12 md:w-2/3 lg:w-1/2 p-6 relative fade-scale">
      <button id="closePost" class="absolute top-4 right-4 text-gray-600"><i class="fas fa-times"></i></button>
      <h2 class="text-2xl mb-4">+ Post Car</h2>
      <form id="postForm" class="space-y-4 max-h-[80vh] overflow-auto">
        <input name="title" type="text" placeholder="Car Name" required class="w-full px-3 py-2 border rounded"/>
        <input name="model" type="text" placeholder="Model" required class="w-full px-3 py-2 border rounded"/>
        <input name="condition" type="text" placeholder="Condition" required class="w-full px-3 py-2 border rounded"/>
        <input name="price" type="number" placeholder="Price" required class="w-full px-3 py-2 border rounded"/>
        <textarea name="description" rows="4" placeholder="Description" class="w-full px-3 py-2 border rounded"></textarea>
        <div>
          <label class="block mb-2">Upload Images (max 20)</label>
          <input id="imgInput" type="file" multiple accept="image/*" class="w-full"/>
          <div id="imgPreview" class="grid grid-cols-3 gap-2 mt-2"></div>
        </div>
        <button type="submit" class="w-full py-2 bg-[#00C9B8] text-[#1A202C] rounded">Publish</button>
      </form>
    </div>
  </div>

  <!-- ========== CAR DETAIL MODAL ========== -->
  <div id="detailModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
    <div class="bg-white rounded-lg w-11/12 md:w-3/4 lg:w-1/2 p-6 relative fade-scale overflow-auto max-h-[90vh]">
      <button id="closeDetail" class="absolute top-4 right-4 text-gray-600"><i class="fas fa-times"></i></button>
      <div id="detailGallery" class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4"></div>
      <h2 id="detailTitle" class="text-2xl font-bold mb-2"></h2>
      <p id="detailModel" class="text-gray-600 mb-2"></p>
      <p id="detailCondition" class="text-gray-600 mb-2"></p>
      <p id="detailPrice" class="text-[#00C9B8] font-semibold mb-4"></p>
      <p id="detailDesc" class="mb-4"></p>
    </div>
  </div>

  <!-- ========== CHAT MODAL ========== -->
  <div id="chatModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
    <div class="bg-white rounded-lg w-11/12 md:w-2/3 lg:w-1/2 p-4 relative fade-scale">
      <button id="closeChat" class="absolute top-4 right-4 text-gray-600"><i class="fas fa-times"></i></button>
      <div class="flex justify-between items-center mb-4">
        <h2 id="chatTitle" class="text-xl">Global Chat</h2>
        <button id="switchChat" class="px-2 py-1 bg-gray-200 rounded text-sm">Private Chat</button>
      </div>
      <div id="chatBody" class="h-64 overflow-auto mb-4 space-y-2"></div>
      <div class="flex items-center">
        <input id="chatInput" type="text" placeholder="Type a message" class="flex-1 px-3 py-2 border rounded"/>
        <button id="sendChat" class="ml-2 px-4 py-2 bg-[#00C9B8] text-[#1A202C] rounded"><i class="fas fa-paper-plane"></i></button>
        <button id="voiceBtn" class="ml-2 px-3 py-2 bg-gray-200 rounded"><i class="fas fa-microphone"></i></button>
      </div>
    </div>
  </div>

  <!-- ========== PROFILE MODAL ========== -->
  <div id="profileModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
    <div class="bg-white rounded-lg w-11/12 md:w-2/3 lg:w-1/2 p-6 relative fade-scale overflow-auto max-h-[90vh]">
      <button id="closeProfile" class="absolute top-4 right-4 text-gray-600"><i class="fas fa-times"></i></button>
      <div class="flex items-center gap-4 mb-6">
        <img id="profilePic" src="" alt="Profile" class="w-20 h-20 rounded-full object-cover border"/>
        <div>
          <h2 id="profileName" class="text-2xl font-bold"></h2>
          <p id="profileContact" class="text-gray-600"></p>
          <p class="flex items-center gap-1">
            <i class="fas fa-star text-yellow-400"></i>
            <span id="profileRating">0.0</span>/
            <span>5</span>
          </p>
        </div>
      </div>
      <div id="profilePosts" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
    </div>
  </div>

  <!-- ========== ADMIN PANEL ========== -->
  <div id="adminPanel" class="fixed top-0 right-0 bg-white w-80 h-full shadow-lg p-4 overflow-auto hidden">
    <h2 class="text-2xl mb-4">Admin Dashboard</h2>
    <div class="mb-4">
      <label class="flex items-center gap-2">
        <input type="checkbox" id="paymentsToggle"/>
        <span>Require Membership Payment</span>
      </label>
    </div>
    <div id="userApprovals" class="mb-6">
      <h3 class="text-lg font-semibold mb-2">Pending Users</h3>
      <!-- pending user cards -->
    </div>
    <div id="moderation" class="mb-6">
      <h3 class="text-lg font-semibold mb-2">Moderation</h3>
      <!-- approve/mute/promote -->
    </div>
    <div id="postApprovals">
      <h3 class="text-lg font-semibold mb-2">Post Approvals</h3>
      <!-- posts awaiting approval -->
    </div>
  </div>

  <!-- ========== SCRIPT LOGIC (Appwrite + UI) ========== -->
  <script>
  // Utility: toggle fade-scale modals
  function openModal(id) {
    const m = document.getElementById(id);
    m.classList.remove('hidden');
    setTimeout(()=> m.querySelector('.fade-scale').classList.add('active'), 10);
  }
  function closeModal(id) {
    const m = document.getElementById(id);
    m.querySelector('.fade-scale').classList.remove('active');
    setTimeout(()=> m.classList.add('hidden'), 300);
  }

  // Language toggle
  const langToggle = document.getElementById('langToggle');
  function applyLang() {
    document.documentElement.lang = lang;
    document.getElementById('authTitle').innerText = STR[lang][ currentUser? 'login':'signup' ];
    document.getElementById('authEmail').placeholder = STR[lang].email;
    document.getElementById('authPassword').placeholder = STR[lang].password;
    authForm.querySelector('button').innerText = currentUser? STR[lang].login:STR[lang].signup;
    authSwitch.innerText = currentUser? STR[lang].signup:STR[lang].login;
    document.getElementById('searchInput').placeholder = STR[lang].search;
    postBtn.innerText = STR[lang].post;
    document.querySelector('#postForm [name="title"]').placeholder = STR[lang].name;
    document.querySelector('#postForm [name="model"]').placeholder = STR[lang].model;
    document.querySelector('#postForm [name="condition"]').placeholder = STR[lang].condition;
    document.querySelector('#postForm [name="price"]').placeholder = STR[lang].price;
    document.querySelector('#postForm textarea').placeholder = STR[lang].description;
    document.querySelector('#postForm label').innerText = STR[lang].upload;
    document.querySelector('#postForm button[type="submit"]').innerText = STR[lang].publish;
    document.getElementById('profileBtn').title = STR[lang].profile;
    document.getElementById('chatBtn').title = STR[lang].globalChat;
    document.getElementById('adminPanel').querySelector('h2').innerText = STR[lang].adminPanel;
    langToggle.innerText = lang==='en'? STR[lang].switchTo : STR[lang].switchTo;
  }
  langToggle.onclick = ()=>{
    lang = lang==='en'? 'ur':'en';
    applyLang();
  };

  // ===== AUTH =====
  const authModal  = document.getElementById('authModal');
  const authForm   = document.getElementById('authForm');
  const authSwitch = document.getElementById('authSwitch');
  let isSignup     = false;

  function showAuth(signup=false) {
    isSignup = signup;
    openModal('authModal');
    document.getElementById('authTitle').innerText = signup? STR[lang].signup:STR[lang].login;
    authForm.querySelector('button').innerText = signup? STR[lang].signup:STR[lang].login;
    authSwitch.innerText = signup? STR[lang].login:STR[lang].signup;
    document.getElementById('authEmail').value = '';
    document.getElementById('authPassword').value = '';
  }
  authSwitch.onclick = ()=> showAuth(!isSignup);
  authForm.onsubmit = async e=>{
    e.preventDefault();
    const email = authEmail.value;
    const pw    = authPassword.value;
    try {
      let session;
      if (isSignup) {
        session = await account.create('unique()', email, pw);
        // create user doc
        await db.createDocument(
          APPWRITE.databases.id,
          APPWRITE.databases.collections.users,
          session.$id,
          { email, status: paymentsRequired?'payment_pending':'active', role:'user', joinedAt:new Date().toISOString() }
        );
        // if first user: make admin
        const list = await db.listDocuments(APPWRITE.databases.id, APPWRITE.databases.collections.users, [], 1, 0, undefined, ['\$createdAt']);
        if (list.total===1) {
          currentRole = 'admin';
          await db.updateDocument(APPWRITE.databases.id, APPWRITE.databases.collections.users, session.$id, { role:'admin', status:'active' });
        }
      } else {
        session = await account.createEmailSession(email, pw);
      }
      currentUser = await account.get();
      closeModal('authModal');
      initApp();
    } catch(err) {
      alert(err.message);
    }
  };

  // ===== INIT APP =====
  async function initApp(){
    try {
      currentUser = await account.get();
    } catch {
      return showAuth(false);
    }
    // fetch role and settings
    const udoc = await db.getDocument(APPWRITE.databases.id, APPWRITE.databases.collections.users, currentUser.$id);
    currentRole = udoc.role;
    paymentsRequired = udoc.paymentsRequired || false;
    // show main UI
    buildApp();
  }

  // ===== BUILD APP UI =====
  const header = document.querySelector('header');
  const mainFeed = document.getElementById('feed');
  const postBtn = document.getElementById('postBtn');
  const profileBtn = document.getElementById('profileBtn');
  const chatBtn = document.getElementById('chatBtn');
  const closePost = document.getElementById('closePost');
  const postModal = document.getElementById('postModal');
  const imgInput = document.getElementById('imgInput');
  const imgPreview = document.getElementById('imgPreview');
  const postForm = document.getElementById('postForm');
  const closeDetail = document.getElementById('closeDetail');
  const detailModal = document.getElementById('detailModal');
  const closeChat = document.getElementById('closeChat');
  const chatModal = document.getElementById('chatModal');
  const switchChat = document.getElementById('switchChat');
  const sendChat = document.getElementById('sendChat');
  const chatBody = document.getElementById('chatBody');
  const chatInput = document.getElementById('chatInput');
  const voiceBtn = document.getElementById('voiceBtn');
  const profileModal = document.getElementById('profileModal');
  const closeProfile = document.getElementById('closeProfile');
  const profilePosts = document.getElementById('profilePosts');
  const paymentsToggle = document.getElementById('paymentsToggle');
  const adminPanel = document.getElementById('adminPanel');

  // Search
  document.getElementById('searchInput').oninput = e => loadFeed(e.target.value);

  // Modals
  postBtn.onclick = ()=> openModal('postModal');
  closePost.onclick = ()=> closeModal('postModal');
  profileBtn.onclick = ()=> openProfile(currentUser.$id);
  closeProfile.onclick = ()=> closeModal('profileModal');
  chatBtn.onclick = ()=> openModal('chatModal');
  closeChat.onclick = ()=> closeModal('chatModal');
  closeDetail.onclick = ()=> closeModal('detailModal');

  // Image preview
  imgInput.onchange = ()=>{
    imgPreview.innerHTML = '';
    Array.from(imgInput.files).slice(0,20).forEach(f=>{
      const r = new FileReader();
      r.onload = e=>{
        const img = document.createElement('img');
        img.src = e.target.result;
        img.className = 'w-full h-24 object-cover rounded';
        imgPreview.appendChild(img);
      };
      r.readAsDataURL(f);
    });
  };

  // ===== LOAD FEED =====
  async function loadFeed(filter=''){
    const resp = await db.listDocuments(
      APPWRITE.databases.id,
      APPWRITE.databases.collections.posts,
      [],
      100, 0,
      filter?`title~=${filter}`:undefined,
      ['-createdAt']
    );
    mainFeed.innerHTML = '';
    resp.documents.forEach(post=>{
      const card = document.createElement('div');
      card.className = 'bg-white p-4 rounded-lg hover-3d cursor-pointer';
      card.innerHTML = `
        <img src="${post.imageURLs?.[0]||''}" class="w-full h-40 object-cover rounded mb-2"/>
        <h3 class="font-bold">${post.title}</h3>
        <p class="text-gray-600 text-sm">${post.model}</p>
        <p class="text-[#00C9B8] font-semibold mt-1">$${post.price}</p>
      `;
      card.onclick = ()=> openDetail(post);
      mainFeed.appendChild(card);
    });
  }

  // Realtime feed
  realtime.subscribe(
    [`databases.${APPWRITE.databases.id}.collections.${APPWRITE.databases.collections.posts}.documents`],
    () => loadFeed(document.getElementById('searchInput').value)
  );

  // ===== POST CREATION =====
  postForm.onsubmit = async e=>{
    e.preventDefault();
    const data = new FormData(e.target);
    // create doc
    const post = await db.createDocument(
      APPWRITE.databases.id,
      APPWRITE.databases.collections.posts,
      Appwrite.ID.unique(),
      {
        title: data.get('title'),
        model: data.get('model'),
        condition: data.get('condition'),
        price: Number(data.get('price')),
        description: data.get('description'),
        ownerId: currentUser.$id,
        createdAt: new Date().toISOString()
      }
    );
    // upload images
    const files = Array.from(imgInput.files).s
</html>
